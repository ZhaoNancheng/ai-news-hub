#!/bin/bash

# AI News è‡ªåŠ¨æ›´æ–°è„šæœ¬ v5.0
# é‡æ–°åˆ†ç±»ï¼šè¡Œä¸šåŠ¨æ€ + ç ”ç©¶å‰æ²¿ + çƒ­é—¨æ¨è

set -e

# é…ç½®
PROJECT_DIR="/data1/cc/vide-coding/ai-news-hub"
NEWS_DIR="$PROJECT_DIR/docs/news"
INDUSTRY_FILE="$PROJECT_DIR/docs/industry.md"
RESEARCH_FILE="$PROJECT_DIR/docs/research.md"
TRENDING_FILE="$PROJECT_DIR/docs/trending.md"
DATE=$(date +"%Y-%m-%d")
DATETIME=$(date +"%Y-%m-%d %H:%M:%S")
TIMESTAMP=$(date +%s)

export PROJECT_DIR NEWS_DIR DATE DATETIME

echo "=========================================="
echo "  AI News è‡ªåŠ¨æ›´æ–°å¼€å§‹ (v5.0 é‡æ–°åˆ†ç±»ç‰ˆ)"
echo "=========================================="
echo "æ—¶é—´: $DATETIME"
echo ""

# åˆ›å»ºç›®å½•
mkdir -p "$NEWS_DIR"

echo "ğŸ“° Step 1: æŠ“å–è¡Œä¸šåŠ¨æ€ï¼ˆTechCrunch ç­‰ï¼‰..."
# python3.9 /data1/cc/vide-coding/ai-news-hub/scripts/fetch_industry_news.py
echo "âš ï¸  è¡Œä¸šåŠ¨æ€æŠ“å–è„šæœ¬å¾…å®ç°"
echo "ğŸ“ æ›´æ–° docs/industry.md"

echo ""
echo "ğŸ”¬ Step 2: æŠ“å– arXiv ç ”ç©¶è®ºæ–‡..."
python3.9 /data1/cc/vide-coding/ai-news-hub/scripts/fetch_arxiv_news.py

echo ""
echo "ğŸ”¥ Step 3: æ›´æ–°çƒ­é—¨æ¨è..."
# python3.9 /data1/cc/vide-coding/ai-news-hub/scripts/update_trending.py
echo "âš ï¸  çƒ­é—¨æ¨èæ›´æ–°è„šæœ¬å¾…å®ç°"
echo "ğŸ“ æ›´æ–° docs/trending.md"

echo ""
echo "ğŸ“Š Step 4: æ›´æ–°ç ”ç©¶å‰æ²¿é¡µé¢..."
echo "ğŸ“ æ›´æ–° docs/research.md"

echo ""
echo "ğŸ”„ Step 5: æ¨é€åˆ° GitHub + GitLab..."
cd "$PROJECT_DIR"

# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add docs/news/ docs/industry.md docs/research.md docs/trending.md

# è·å–æ–‡ä»¶è¡Œæ•°
NEWS_LINES=$(wc -l < "$NEWS_DIR/$DATE.md" 2>/dev/null || echo "0")

# æäº¤æ›´æ”¹
COMMIT_MSG="Auto-update: AI News briefing - $DATE

- News: $NEWS_LINES lines
- Industry: Updated
- Research: Updated
- Trending: Updated
- Timestamp: $TIMESTAMP
- Auto-generated by ai-news-hub v5.0"

git commit -m "$COMMIT_MSG" || echo "âš ï¸  æ²¡æœ‰æ–°çš„æ›´æ”¹éœ€è¦æäº¤"

# æ¨é€åˆ° GitHub
echo "æ¨é€åˆ° GitHub..."
git push origin main || echo "âš ï¸  GitHub æ¨é€å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼‰"

echo ""
echo "æ¨é€åˆ° GitLab..."
git push gitlab main || echo "âš ï¸  GitLab æ¨é€å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼‰"

echo ""
echo "âœ… æˆåŠŸæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼"
echo "Vercel å°†è‡ªåŠ¨æ£€æµ‹å¹¶é‡æ–°éƒ¨ç½²..."

echo ""
echo "=========================================="
echo "  è‡ªåŠ¨æ›´æ–°å®Œæˆï¼"
echo "=========================================="
echo "å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
echo ""
